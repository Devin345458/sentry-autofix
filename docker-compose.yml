services:
  sentry-autofix:
    build: .
    restart: unless-stopped
    ports:
      - "3000:3000"
    volumes:
      - sentry-autofix-data:/data
      - sentry-autofix-repos:/repos
    environment:
      - SENTRY_WEBHOOK_SECRET=${SENTRY_WEBHOOK_SECRET}
      - SENTRY_AUTH_TOKEN=${SENTRY_AUTH_TOKEN}
      - SENTRY_ORG_SLUG=${SENTRY_ORG_SLUG}
      - GITHUB_TOKEN=${GITHUB_TOKEN}
      - ANTHROPIC_API_KEY=${ANTHROPIC_API_KEY}
      - CLAUDE_CODE_PATH=claude-code
      - CLAUDE_MODEL=sonnet-4-5
      - CONFIG_PATH=/app/config.json
      - DB_PATH=/data/sentry-autofix.db
      - REPOS_DIR=/repos
      - PORT=3000
      - MAX_CONCURRENT_FIXES=1
      - MAX_ATTEMPTS_PER_ISSUE=2
    configs:
      - source: project_config
        target: /app/config.json

configs:
  project_config:
    content: |
      {
        "projects": {}
      }

volumes:
  sentry-autofix-data:
  sentry-autofix-repos:
